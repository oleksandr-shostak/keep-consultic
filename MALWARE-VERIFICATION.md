# Malware Verification Guide

## Current Status: ‚úÖ CLEAN

As of **2025-12-10 10:39 UTC**, your Keep server shows **no active malware**.

## How to Verify Your Server is Malware-Free

### Quick Check (30 seconds)

Run this from your local machine:

```bash
./monitor-malware.sh
```

**Expected output:**
```
‚úì No malicious processes found
‚úì No malware activity in logs
‚úì Keep API responding (HTTP 200)
‚úì Keep service is active
```

If you see all ‚úì checkmarks, **your server is clean**.

### Detailed Verification Steps

#### 1. Check for Malicious Processes

```bash
ssh root@keephq-cjm9.consultic.tech "ps aux | grep -E '176.117|wget.*r.sh|curl.*r.sh' | grep -v grep"
```

**Expected**: No output (exit code 1) = ‚úÖ Clean

**Problem**: If you see processes = ‚ö†Ô∏è Malware active

#### 2. Check Frontend Logs

```bash
ssh root@keephq-cjm9.consultic.tech "grep -c '176.117.107.158' /opt/keep/logs/frontend.log"
```

**Expected**: `0` = ‚úÖ Clean

**Problem**: Any number > 0 = ‚ö†Ô∏è Malware has been active

#### 3. Check Network Connections

```bash
ssh root@keephq-cjm9.consultic.tech "netstat -tunap | grep 176.117.107.158"
```

**Expected**: No output (exit code 1) = ‚úÖ Clean

**Problem**: Active connections = ‚ö†Ô∏è Malware communicating

#### 4. Verify Keep is Running

```bash
ssh root@keephq-cjm9.consultic.tech "curl -s http://127.0.0.1:8080/ | grep version"
```

**Expected**: `"version":"0.47.11"` (or similar) = ‚úÖ Running

**Problem**: Connection error = ‚ö†Ô∏è Server down

## Monitoring Schedule

### Recommended: Run checks periodically

**Option 1: Manual monitoring**
```bash
# Run every 10 minutes while testing
watch -n 600 "./monitor-malware.sh"
```

**Option 2: Set up cron job** (on your local machine)
```bash
# Add to crontab (crontab -e):
*/10 * * * * cd /path/to/keep-consultic && ./monitor-malware.sh >> /tmp/keep-monitor.log 2>&1
```

**Option 3: On-demand checks**
Just run `./monitor-malware.sh` whenever you want to verify status.

## What to Look For

### Signs Server is Clean ‚úÖ

- No processes with IPs like 176.117.107.158
- Malware count in logs = 0
- Keep API responding HTTP 200
- Server uptime increasing (not restarting)
- No unexpected CPU/memory spikes

### Signs of Malware ‚ö†Ô∏è

- Processes running `wget` or `curl` with suspicious URLs
- Malware count > 0 in frontend logs
- Server crashes every 15-30 minutes
- High CPU usage from unknown processes
- Network connections to 176.117.107.158

## If Malware Returns

### Immediate Actions

1. **Kill malicious processes:**
   ```bash
   ssh root@keephq-cjm9.consultic.tech "pkill -9 -f '176.117.107.158'"
   ```

2. **Run security check:**
   ```bash
   ssh root@keephq-cjm9.consultic.tech "cd /opt/keep && ./security-check.sh"
   ```

3. **Check server logs:**
   ```bash
   ssh root@keephq-cjm9.consultic.tech "tail -100 /opt/keep/logs/frontend.log | grep -A5 -B5 '176.117.107.158'"
   ```

### Permanent Fix (If Malware Persists)

You **must rebuild the frontend** to permanently eliminate the malware:

```bash
ssh root@keephq-cjm9.consultic.tech
sudo systemctl stop keep.service
cd /opt/keep/keep-ui
rm -rf node_modules .next
npm cache clean --force
npm install
npm run build
cd /opt/keep
sudo systemctl start keep.service
```

## Monitoring Over Time

### First 24 Hours After Restart

- Run `./monitor-malware.sh` **every 10 minutes**
- Watch for malware count increasing
- If malware count stays 0 for 24 hours ‚Üí ‚úÖ Likely clean

### After 24 Hours Clean

- Reduce checks to **every hour**
- Monitor server stability (no crashes)
- If clean for 7 days ‚Üí ‚úÖ Very likely clean

### Long-term Monitoring

- Run `./monitor-malware.sh` **once per day**
- Check server uptime (should be weeks/months)
- Review logs periodically

## Current Baseline

**Server restarted**: 2025-12-10 10:36 UTC
**Malware count**: 0
**Status**: Clean
**Next check**: Monitor for 24 hours

## Available Scripts

All scripts are in the repository root:

| Script | Purpose | Run From |
|--------|---------|----------|
| `monitor-malware.sh` | Quick malware check | Local machine |
| `security-check.sh` | Full security scan | On server |
| `quick-check.sh` | Health check | Local machine |
| `diagnose-keep.sh` | Full diagnostics | Local machine |

## Questions to Answer

### Is my server safe now?
‚úÖ **Yes**, currently clean with no active malware.

### How long will it stay clean?
‚ö†Ô∏è **Unknown** - malware may return if compromised package still exists.

### Do I need to rebuild?
üí° **Recommended** - rebuilding ensures permanent removal.

### How do I know if malware comes back?
üìä Run `./monitor-malware.sh` - if malware count increases, it's back.

---

**Last Updated**: 2025-12-10 10:39 UTC
**Status**: Clean
**Action Required**: Monitor for 24 hours, consider rebuild for permanent fix
