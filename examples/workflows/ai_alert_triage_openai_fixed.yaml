workflow:
  id: ai_alert_triage_openai
  name: "AI Alert Triage with OpenAI"
  description: Use OpenAI to analyze each alert and decide if it's important
  disabled: false
  triggers:
    - type: alert
      cel: "severity == 'info'"
  steps:
    - name: ai_analyze_alert
      provider:
        type: openaiassistant
        config: "{{ providers.Triage }}"
        with:
          prompt: |
            Analyze this alert and decide if it's important:
            **Alert Name:** {{ alert.name }}
            - Source: {{ alert.source }}
            **Status:** {{ alert.status }}
            **Description:** {{ alert.description }}
            **Message:** {{ alert.message }}

            Determine if this alert should be:
            1. ESCALATED to critical priority (production outages, security issues, data loss, critical service failures)
            2. RESOLVED as noise/informational (test alerts, informational messages, auto-recovered issues, duplicates)

            Respond ONLY with valid JSON in this exact format:

            {"recommended_action": "resolve", "reason": "brief explanation"}
            OR
            {"recommended_action": "escalate", "reason": "brief explanation"}
  actions:
    - name: escalate_to_critical
      if: "'{{ steps.ai_analyze_alert.results.response.recommended_action }}' == 'escalate'"
      provider:
        type: keep
        config: "{{ providers.default-keep }}"
        with:
          read_only: true
          alert:
            name: "AI: {{ alert.name }}"
            status: firing
            severity: warning
            message: |
              AI ESCALATION: This alert has been automatically escalated to WARNING priority.

              AI Analysis: {{ steps.ai_analyze_alert.results.response.reason }}

              Original Alert Details:
              - Name: {{ alert.name }}
              - Description: {{ alert.description }}

              === Original Message ===
              {{ alert.message }}

              View original alert ID: {{ alert.id }}
            fingerprint: "ai-escalated-{{ alert.fingerprint }}"
